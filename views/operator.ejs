<!-- --------------------------------------------------------------------------
Timestamp: 2026-01-28
File: views/operator.ejs
Purpose: Operator dashboard with dynamic MikroTik profiles, print button, and toast notifications
---------------------------------------------------------------------------- -->
<!DOCTYPE html>
<html>
<head>
  <title>Operator Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2 class="mb-4">Operator Dashboard</h2>

    <div class="mb-3">
      <strong>Total vouchers sold today:</strong> <%= totalSoldToday %>
    </div>

    <!-- Sell Voucher -->
    <form action="/operator/sell" method="POST" class="row g-3 mb-4">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <div class="col-auto">
        <select name="profile" class="form-select" required>
          <option value="">Select Profile</option>
          <% if (profiles) { %>
            <% Object.keys(profiles).forEach(function(p) { %>
              <option value="<%= p %>">
                <%= p %> (Price: <%= profiles[p].price %> FCFA)
              </option>
            <% }) %>
          <% } else { %>
            <option disabled>No profiles available</option>
          <% } %>
        </select>
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-success">Sell</button>
      </div>
    </form>

    <% if (voucher) { %>
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Voucher Sold</h5>
          <p><strong>Username:</strong> <%= voucher.username %></p>
          <% if (voucher.expectedPrice) { %>
            <p><strong>Expected Price:</strong> <%= voucher.expectedPrice %> FCFA</p>
          <% } %>

          <% if (!voucher.password) { %>
            <form action="/pay/cash" method="POST" class="row g-3">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <input type="hidden" name="voucherId" value="<%= voucher.id %>">
              <div class="col-auto">
                <input type="number" name="amount" class="form-control" placeholder="Cash Received (FCFA)" required>
              </div>
              <div class="col-auto">
                <button type="submit" class="btn btn-primary">Confirm Sale</button>
              </div>
            </form>
          <% } else { %>
            <p><strong>Password:</strong> <%= voucher.password %></p>
            <button class="btn btn-outline-secondary" onclick="window.print()">Print</button>
            <div class="alert alert-success mt-3">Voucher is ready to be handed to the client.</div>
          <% } %>
        </div>
      </div>
    <% } %>

    <% if (toastMessage) { %>
      <div class="toast align-items-center text-bg-success border-0 show mt-3" role="alert">
        <div class="d-flex">
          <div class="toast-body">
            <%= toastMessage %>
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      </div>
    <% } %>
  </div>
</body>
</html>

