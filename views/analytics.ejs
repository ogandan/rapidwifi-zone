<!-- File: views/analytics.ejs -->
<!DOCTYPE html>
<html>
<head>
  <title>Analytics Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="container py-4">
  <h2 class="mb-4">Analytics Dashboard</h2>

  <!-- Charts Row 1 -->
  <div class="row">
    <div class="col-md-6 mb-4">
      <canvas id="statusChart"></canvas>
    </div>
    <div class="col-md-6 mb-4">
      <canvas id="profileChart"></canvas>
    </div>
  </div>

  <!-- Charts Row 2 -->
  <div class="row">
    <div class="col-md-6 mb-4">
      <canvas id="creationChart"></canvas>
    </div>
    <div class="col-md-6 mb-4">
      <canvas id="trendsChart"></canvas>
    </div>
  </div>

  <!-- Charts Row 3 -->
  <div class="row">
    <div class="col-md-12 mb-4">
      <canvas id="exportsChart"></canvas>
    </div>
  </div>

  <script>
    fetch('/admin/stats')
      .then(res => res.json())
      .then(data => {
        // Status chart (active vs inactive)
        new Chart(document.getElementById('statusChart'), {
          type: 'doughnut',
          data: {
            labels: ['Active', 'Inactive'],
            datasets: [{
              data: [data.active, data.inactive],
              backgroundColor: ['#28a745', '#dc3545']
            }]
          },
          options: { plugins: { title: { display: true, text: 'Voucher Status' } } }
        });

        // Profile distribution chart
        new Chart(document.getElementById('profileChart'), {
          type: 'bar',
          data: {
            labels: Object.keys(data.profiles),
            datasets: [{
              label: 'Vouchers by Profile',
              data: Object.values(data.profiles),
              backgroundColor: '#007bff'
            }]
          },
          options: { plugins: { title: { display: true, text: 'Profile Distribution' } } }
        });

        // Voucher counts last 7 days
        new Chart(document.getElementById('creationChart'), {
          type: 'line',
          data: {
            labels: data.creation7days.labels,
            datasets: [{
              label: 'Vouchers Created (Last 7 Days)',
              data: data.creation7days.values,
              borderColor: '#17a2b8',
              fill: false
            }]
          },
          options: { plugins: { title: { display: true, text: 'Voucher Counts (Last 7 Days)' } } }
        });

        // Trends chart (longer time series)
        new Chart(document.getElementById('trendsChart'), {
          type: 'line',
          data: {
            labels: data.trends.labels,
            datasets: [{
              label: 'Voucher Creation Trends',
              data: data.trends.values,
              borderColor: '#6f42c1',
              fill: false
            }]
          },
          options: { plugins: { title: { display: true, text: 'Voucher Creation Trends' } } }
        });

        // Exports chart
        new Chart(document.getElementById('exportsChart'), {
          type: 'bar',
          data: {
            labels: Object.keys(data.exportsByProfile),
            datasets: [{
              label: 'Exports by Profile',
              data: Object.values(data.exportsByProfile),
              backgroundColor: '#ffc107'
            },
            {
              label: 'Exports Over Time',
              data: data.exportsOverTime.values,
              backgroundColor: '#20c997'
            }]
          },
          options: { plugins: { title: { display: true, text: 'Exports (CSV/JSON)' } } }
        });
      })
      .catch(err => console.error('Error loading stats:', err));
  </script>
</body>
</html>

