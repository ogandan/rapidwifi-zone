<!-- Operator Management -->
<h4>Operator Management</h4>
<form action="/admin/operator/create" method="POST" class="row g-3 mb-3">
  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
  <div class="col-auto">
    <input type="text" name="username" class="form-control" placeholder="Operator Username" required>
  </div>
  <div class="col-auto">
    <input type="password" name="password" class="form-control" placeholder="Password" required>
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-success">Create Operator</button>
  </div>
</form>

<table id="operatorsTable" class="table table-striped table-bordered"></table>

<!-- Voucher Filters -->
<h4>Voucher Filters</h4>
<div class="mb-3">
  <select id="statusFilter" class="form-select d-inline w-auto">
    <option value="">All Statuses</option>
    <option value="active">Active</option>
    <option value="sold">Sold</option>
    <option value="inactive">Inactive</option>
    <option value="expired">Expired</option>
  </select>
  <select id="profileFilter" class="form-select d-inline w-auto">
    <option value="">All Profiles</option>
    <% Object.keys(profiles).forEach(function(p) { %>
      <option value="<%= p %>"><%= p %></option>
    <% }) %>
  </select>
  <input type="date" id="dateFilter" class="form-control d-inline w-auto">
  <input type="text" id="createdByFilter" class="form-control d-inline w-auto" placeholder="Created By">
</div>

<!-- Bulk Actions -->
<h4>Bulk Actions</h4>
<div class="mb-3">
  <button id="bulkActivate" class="btn btn-success">Activate Selected</button>
  <button id="bulkBlock" class="btn btn-warning">Block Selected</button>
  <button id="bulkDelete" class="btn btn-danger">Delete Selected</button>
</div>

<script>
  $(document).ready(function() {
    // Operators DataTable
    const operatorsTable = $('#operatorsTable').DataTable({
      ajax: '/api/operators',
      columns: [
        { data: 'id', title: 'ID' },
        { data: 'name', title: 'Username' },
        { data: 'role', title: 'Role' },
        { data: 'active', title: 'Active' },
        { data: 'created_at', title: 'Created At' }
      ]
    });

    // Voucher DataTable with checkboxes
    const voucherTable = $('#voucherTable').DataTable({
      ajax: '/api/vouchers',
      columns: [
        { data: 'id', title: 'Select',
          render: function(data) {
            return `<input type="checkbox" class="voucher-select" value="${data}">`;
          }
        },
        { data: 'username', title: 'Username' },
        { data: 'password', title: 'Password' },
        { data: 'profile', title: 'Profile' },
        { data: 'status', title: 'Status' },
        { data: 'created_by', title: 'Created By' },
        { data: 'created_at', title: 'Created At' }
      ],
      order: [[6, 'desc']],
      pageLength: 25,
      dom: 'Bfrtip',
      buttons: ['csv', 'excel']
    });

    // Bulk action handlers
    function getSelectedVoucherIds() {
      return $('.voucher-select:checked').map(function() { return this.value; }).get();
    }

    $('#bulkActivate').click(function() {
      const ids = getSelectedVoucherIds();
      $.post('/admin/vouchers/bulk-activate', { ids, _csrf: '<%= csrfToken %>' });
    });
    $('#bulkBlock').click(function() {
      const ids = getSelectedVoucherIds();
      $.post('/admin/vouchers/bulk-block', { ids, _csrf: '<%= csrfToken %>' });
    });
    $('#bulkDelete').click(function() {
      const ids = getSelectedVoucherIds();
      $.post('/admin/vouchers/bulk-delete', { ids, _csrf: '<%= csrfToken %>' });
    });
  });
</script>

