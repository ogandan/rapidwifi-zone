<form id="batchForm" method="POST">
  <div class="batch-actions">
    <select id="batchAction" name="action" required>
      <option value="">-- Select Action --</option>
      <option value="block">Block Selected</option>
      <option value="delete">Delete Selected</option>
    </select>
    <button type="submit">Apply</button>
  </div>

  <table>
    <thead>
      <tr>
        <th><input type="checkbox" id="selectAll"></th>
        <th>Username</th>
        <th>Profile</th>
        <th>Status</th>
        <th>Created At</th>
      </tr>
    </thead>
    <tbody>
      <% vouchers.forEach(function(v) { %>
        <tr>
          <td><input type="checkbox" name="usernames" value="<%= v.username %>"></td>
          <td><%= v.username %></td>
          <td><%= v.profile %></td>
          <td><%= v.status %></td>
          <td><%= v.created_at %></td>
        </tr>
      <% }); %>
    </tbody>
  </table>
</form>

<script>
  // Select/Deselect all checkboxes
  document.getElementById('selectAll').addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('input[name="usernames"]');
    checkboxes.forEach(cb => cb.checked = this.checked);
  });

  // Handle batch form submission
  document.getElementById('batchForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const action = document.getElementById('batchAction').value;
    const selected = Array.from(document.querySelectorAll('input[name="usernames"]:checked'))
                          .map(cb => cb.value);

    if (!action || selected.length === 0) {
      alert('Please select an action and at least one voucher.');
      return;
    }

    try {
      const response = await fetch(`/admin/batch/${action}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ usernames: selected })
      });
      const result = await response.json();
      if (result.success) {
        alert(`${action} completed for ${selected.length} vouchers`);
        location.reload();
      } else {
        alert('Batch action failed');
      }
    } catch (err) {
      console.error('Batch action error:', err);
      alert('Error performing batch action');
    }
  });
</script>

